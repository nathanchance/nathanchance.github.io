<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>April 2021 ClangBuiltLinux Work | Nathan Chancellor</title>
<meta name="keywords" content="clangbuiltlinux, linux, linuxfoundation, maintainer">
<meta name="description" content="Another month down! Feels like I just wrote the March 2021 post&hellip; but I suppose that is what happens when your project moves super quickly :)
Linux kernel patches   [PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute: I discovered this issue as part of my testing of Sami Tolvanen&rsquo;s Control Flow Integrity series (more on that below). There are probably many more of these lurking because this pattern is hard to spot without runtime testing.">
<meta name="author" content="Nathan Chancellor">
<link rel="canonical" href="https://nathanchance.dev/posts/april-2021-cbl-work/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://nathanchance.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://nathanchance.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://nathanchance.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://nathanchance.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://nathanchance.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="April 2021 ClangBuiltLinux Work" />
<meta property="og:description" content="Another month down! Feels like I just wrote the March 2021 post&hellip; but I suppose that is what happens when your project moves super quickly :)
Linux kernel patches   [PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute: I discovered this issue as part of my testing of Sami Tolvanen&rsquo;s Control Flow Integrity series (more on that below). There are probably many more of these lurking because this pattern is hard to spot without runtime testing." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathanchance.dev/posts/april-2021-cbl-work/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-30T21:14:13-07:00" />
<meta property="article:modified_time" content="2021-04-30T21:14:13-07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="April 2021 ClangBuiltLinux Work"/>
<meta name="twitter:description" content="Another month down! Feels like I just wrote the March 2021 post&hellip; but I suppose that is what happens when your project moves super quickly :)
Linux kernel patches   [PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute: I discovered this issue as part of my testing of Sami Tolvanen&rsquo;s Control Flow Integrity series (more on that below). There are probably many more of these lurking because this pattern is hard to spot without runtime testing."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://nathanchance.dev/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "April 2021 ClangBuiltLinux Work",
      "item": "https://nathanchance.dev/posts/april-2021-cbl-work/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "April 2021 ClangBuiltLinux Work",
  "name": "April 2021 ClangBuiltLinux Work",
  "description": "Another month down! Feels like I just wrote the March 2021 post\u0026hellip; but I suppose that is what happens when your project moves super quickly :)\nLinux kernel patches   [PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute: I discovered this issue as part of my testing of Sami Tolvanen\u0026rsquo;s Control Flow Integrity series (more on that below). There are probably many more of these lurking because this pattern is hard to spot without runtime testing.",
  "keywords": [
    "clangbuiltlinux", "linux", "linuxfoundation", "maintainer"
  ],
  "articleBody": "Another month down! Feels like I just wrote the March 2021 post… but I suppose that is what happens when your project moves super quickly :)\nLinux kernel patches   [PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute: I discovered this issue as part of my testing of Sami Tolvanen’s Control Flow Integrity series (more on that below). There are probably many more of these lurking because this pattern is hard to spot without runtime testing. As I have time amongst all of the other issues and such, I will be testing the x86 variant of CFI on several different servers, trying to flush out all of the different issues there.\n  [PATCH] block: Disable -Walign-mismatch for blk-mq.c: A new warning in clang pointed this out. Unfortunately, the alignment mismatch is expected so I initially sent this patch silencing the warning but it seems like there might be a better solution.\n  [PATCH] MIPS: generic: Update node names to avoid unit addresses: The latest version of U-Boot caused all generic MIPS configurations to stop building, which disrupted my local testing. To get back to a working state, I send this patch.\n  [PATCH] crypto: arm/curve25519 - Move '.fpu' after '.arch': Debian’s clang, which we use for testing in our continuous-integration, includes an out of tree patch that turns off NEON in armv7 by default, causing a build error when trying to build ARCH=arm allmodconfig. Moving the .fpu after .arch fixes the issue because .arch overrides the previous .fpu directive.\n  [PATCH] arm64: alternatives: Move length validation in alternative_{insn,endif}: More integrated assembler fixes. This is similar to another fix that went into the tree last year, this should make it so we never see this issue again, hopefully…\n  [PATCH 1/2] x86/events/amd/iommu: Fix sysfs type mismatch and [PATCH 2/2] perf/amd/uncore: Fix sysfs type mismatch: More type mismatches from CFI testing. These should have been found and fixed during commit ebd19fc372e3 but it does not look like anyone has tested CFI on a more recent AMD CPU.\n  [PATCH] drm/tegra: Fix shift overflow in tegra_shared_plane_atomic_update: Just a small clang warning patch.\n  [PATCH] kbuild: Add $(KBUILD_HOSTLDFLAGS) to 'has_libelf' test: During a regular kernel build, compiling and linking happen in two separate phases, using the variables $(CC) and $(LD), so it is easy to ensure that you are using only the tools that you want. An ultimate goal of ClangBuiltLinux is to be able to build the kernel in an environment free of GCC and binutils and these two variables make it easy to ensure that happens. However, during the host tools building, compiling and linking happens through only the compiler, like a more standard userspace project, and that means that the compiler’s default linker is used, unless -fuse-ld= is provided via the command line. If a project is not able to change their default linker but still wants to test in a hermetic environment, -fuse-ld=lld needs to work properly but without this patch, it does not. This came up during testing from Google, where they have a Docker image that only includes the tools needed for a kernel build so if there is a call to a tool that does not exist, the build errors.\n  [PATCH] powerpc: Avoid clang uninitialized warning in __get_user_size_allowed: Clang’s static analysis pointed out a false positive, which was fixed in one place but not another, causing a build failure in our CI due to -Werror in arch/powerpc.\n  [PATCH] Makefile: Move -Wno-unused-but-set-variable out of GCC only block: Clang’s implementation of this warning is coming down the pipeline so this disables it like GCC in a default build. Ideally, we want to enable rather than disable warnings but this is a special case because it is also disabled for GCC by default.\n  [PATCH] x86: Enable clang LTO for 32-bit as well: LTO was merged in 5.12 for arm64 and x86_64. In my testing, I noticed that 32-bit x86 works fine and there is some interest in this.\n  Patch review and input When possible, I link directly to my response but sometimes, the link is to the main post and my response can be seen inline.\n  Re: [PATCH v5 00/18] Add support for Clang CFI\n  overlay: Exit rcS script so it only runs once\n  Re: [PATCH 3/3] kbuild: fix false-positive modpost warning when all symbols are trimmed\n  [PATCH 0/2] gcov: re-fix clang-11 support\n  Re: [PATCH v4 12/12] exec: Fix overlap of PAGE_ANON and PAGE_TARGET_1\n  Re: [PATCH v9] pgo: add clang's Profile Guided Optimization infrastructure\n  Re: [PATCH] arm64: vdso32: drop -no-integrated-as flag\n  Re: [PATCH v2] arm64: vdso32: drop -no-integrated-as flag\n  [Aarch64] handle \"o\" inline asm memory constraints\n  Re: [PATCH] KVM: x86: Fix implicit enum conversion goof in scattered reverse CPUID code\n  Re: [PATCH] x86/boot/compressed: enable -Wundef\n  Re: [PATCH] stack: replace \"o\" output with \"r\" input constraint\n  Hexagon CI coverage\n  [PowerPC] Handle inline assembly clobber of link regsiter\n  Assertion MI-getOperand(0).isReg()’ failed`\n  Issue triage and reporting A lot more issues in upstream LLVM this month and I ran into two regressions with external tools. Thankfully, those were quick to be resolved so testing could get back on track. As with previous months, the link is usually to the main post/issue and my input can be seen throughout.\n  qemu-aarch64-static \"Illegal instruction\" with debootstrap\n  CFI violation in drivers/infiniband/core/sysfs.c\n  mkimage regression when building ARCH=mips defconfig Linux kernel\n  inconsistent ORC unwind table entries in file: vmlinux in /scripts/sorttable vmlinux\n  -Wframe-larger-than= in sound/core/control_led.c\n  perl spam when running tuxmake without a runtime\n  clang-nightly arm toolchain outdated?\n  undefined symbol: __compiletime_assert_177 in firmware/stratix10-rsu.o\n  ppc44x_defconfig has stopped booting on next\n  \"error: expected assembly-time absolute expression\" in arch/arm64/kernel/entry.S\n  arch/arm64/kvm/perf.c:58:36: error: implicit declaration of function 'perf_num_counters'\n  Re: [PATCH 2/3] habanalabs: support legacy and new pll indexes\n  s390: Issue around the ALTERNATIVE macro with integrated-as\n  error: couldn't allocate output register for constraint 'x'\n  -Wsometimes-uninitialized in arch/powerpc/include/asm/uaccess.h\n  Re: [PATCH v7] powerpc/irq: Inline call_do_irq() and call_do_softirq()\n  [Passes] Add relative lookup table converter pass\n  [DebugInfo] Use variadic debug values to salvage BinOps and GEP instrs with non-const operands\n  \"Not a NOP\" warning when booting i386_defconfig\n  Generalize getInvertibleOperand recurrence handling slightly\n  chkobjdump.awk: no default action when using llvm-objdump\n  Formatting of llvm-objdump trips up x86 insn_decoder_test\n  Re: Very slow clang kernel config ..\n  5.12 boot failure when ThinLTO is enabled\n  -Wconstant-conversion in drivers/platform/surface/surface_aggregator_registry.c\n  Tooling improvements A little all over the place this month, no major work now that the continuous integration setup is stable and the other tools are working well.\n  build-llvm.py: Build compiler-rt builtins\n  buildroot: Check init.d action to avoid double version print out\n  debian/build.sh: qemu-debootstrap - debootstrap\n  Make it green as of 4-26-2021\n  boot-qemu.sh: Do not set earlycon for arm32_v6\n  Enable LLVM_IAS=1 for arm32 allmodconfig on android-mainline\n  Behind the scenes Three things that were more behind the scenes this month:\n  ClangBuiltLinux did a bug scrub on two days, where we sat down in Google Meet and worked on a shared Google Doc to try and see if we could reproduce old issues. I think we ended up touching somewhere around 100 issues, closing several issues that are no longer relevant. This will allow us to stay focused and work through a clean backlog as we have time in the future. It is the balance of dealing with new issues while finding time to work on the old or getting more people involved with the project ;)\n  I did a lot of testing of the Control Flow Integrity series on both arm64 (which I mention above) and x86_64. Unfortunately, the x86_64 testing became moot when the x86 maintainers basically NAK’d the series in its current form. I will continue testing in May, hoping to tease out any failures so that those are all resolved by the time the series is ready for a new revision.\n  I received a BeagleV board as part of their beta program for the sake of testing clang built kernels on it. I messed around with it a little bit already, I will continue this in May.\n  Special thanks to:  Google and the Linux Foundation for sponsoring my work!  ",
  "wordCount" : "1316",
  "inLanguage": "en",
  "datePublished": "2021-04-30T21:14:13-07:00",
  "dateModified": "2021-04-30T21:14:13-07:00",
  "author":{
    "@type": "Person",
    "name": "Nathan Chancellor"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nathanchance.dev/posts/april-2021-cbl-work/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nathan Chancellor",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nathanchance.dev/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://nathanchance.dev/" accesskey="h" title="Nathan Chancellor (Alt + H)">Nathan Chancellor</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://nathanchance.dev/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/nc_resume.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/downloads/" title="Downloads">
                    <span>Downloads</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      April 2021 ClangBuiltLinux Work
    </h1>
    <div class="post-meta"><span title='2021-04-30 21:14:13 -0700 MST'>April 30, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Nathan Chancellor&nbsp;|&nbsp;<a href="https://github.com/nathanchance/hugo-files/blob/main/content/posts/april-2021-cbl-work.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#linux-kernel-patches" aria-label="Linux kernel patches">Linux kernel patches</a></li>
                <li>
                    <a href="#patch-review-and-input" aria-label="Patch review and input">Patch review and input</a></li>
                <li>
                    <a href="#issue-triage-and-reporting" aria-label="Issue triage and reporting">Issue triage and reporting</a></li>
                <li>
                    <a href="#tooling-improvements" aria-label="Tooling improvements">Tooling improvements</a></li>
                <li>
                    <a href="#behind-the-scenes" aria-label="Behind the scenes">Behind the scenes</a></li>
                <li>
                    <a href="#special-thanks-to" aria-label="Special thanks to:">Special thanks to:</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Another month down! Feels like I just wrote the March 2021 post&hellip; but I suppose that is what happens when your project moves super quickly :)</p>
<h2 id="linux-kernel-patches">Linux kernel patches<a hidden class="anchor" aria-hidden="true" href="#linux-kernel-patches">#</a></h2>
<ul>
<li>
<p><a href="https://lore.kernel.org/r/20210407213048.940498-1-nathan@kernel.org/"><code>[PATCH] ACPI / CPPC: Replace cppc_attr with kobj_attribute</code></a>: I discovered this issue as part of my testing of Sami Tolvanen&rsquo;s Control Flow Integrity series (more on that below). There are probably <a href="https://lore.kernel.org/r/202006112217.2E6CE093@keescook/">many more of these lurking</a> because this pattern is hard to spot without runtime testing. As I have time amongst all of the other issues and such, I will be testing the x86 variant of CFI on several different servers, trying to flush out all of the different issues there.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210408194458.501617-1-nathan@kernel.org/"><code>[PATCH] block: Disable -Walign-mismatch for blk-mq.c</code></a>: A new warning in clang pointed this out. Unfortunately, the alignment mismatch is expected so I initially sent this patch silencing the warning but it seems like there might be a <a href="https://lore.kernel.org/r/20210429150940.3256656-1-arnd@kernel.org/">better solution</a>.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210409192128.3998606-1-nathan@kernel.org/"><code>[PATCH] MIPS: generic: Update node names to avoid unit addresses</code></a>: The latest version of U-Boot caused all generic MIPS configurations to stop building, which disrupted my local testing. To get back to a working state, I send this patch.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210409221155.1113205-1-nathan@kernel.org/"><code>[PATCH] crypto: arm/curve25519 - Move '.fpu' after '.arch'</code></a>: Debian&rsquo;s clang, which we use for testing in our continuous-integration, includes an out of tree patch that turns off NEON in armv7 by default, causing a build error when trying to build ARCH=arm allmodconfig. Moving the <code>.fpu</code> after <code>.arch</code> fixes the issue because <code>.arch</code> overrides the previous <code>.fpu</code> directive.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210414000803.662534-1-nathan@kernel.org/"><code>[PATCH] arm64: alternatives: Move length validation in alternative_{insn,endif}</code></a>: More integrated assembler fixes. This is similar to another fix that went into the tree last year, this should make it so we never see this issue again, hopefully&hellip;</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210415001112.3024673-1-nathan@kernel.org/"><code>[PATCH 1/2] x86/events/amd/iommu: Fix sysfs type mismatch</code></a> and <a href="https://lore.kernel.org/r/20210415001112.3024673-2-nathan@kernel.org/"><code>[PATCH 2/2] perf/amd/uncore: Fix sysfs type mismatch</code></a>: More type mismatches from CFI testing. These should have been found and fixed during commit <a href="https://git.kernel.org/linus/ebd19fc372e3"><code>ebd19fc372e3</code></a> but it does not look like anyone has tested CFI on a more recent AMD CPU.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210415152913.1363964-1-nathan@kernel.org/"><code>[PATCH] drm/tegra: Fix shift overflow in tegra_shared_plane_atomic_update</code></a>: Just a small clang warning patch.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210422201914.3682494-1-nathan@kernel.org/"><code>[PATCH] kbuild: Add $(KBUILD_HOSTLDFLAGS) to 'has_libelf' test</code></a>: During a regular kernel build, compiling and linking happen in two separate phases, using the variables <code>$(CC)</code> and <code>$(LD)</code>, so it is easy to ensure that you are using only the tools that you want. An ultimate goal of ClangBuiltLinux is to be able to build the kernel in an environment free of GCC and binutils and these two variables make it easy to ensure that happens. However, during the host tools building, compiling and linking happens through only the compiler, like a more standard userspace project, and that means that the compiler&rsquo;s default linker is used, unless <code>-fuse-ld=</code> is provided via the command line. If a project is not able to change their default linker but still wants to test in a hermetic environment, <code>-fuse-ld=lld</code> needs to work properly but without this patch, it does not. This came up during testing from Google, where they have a Docker image that only includes the tools needed for a kernel build so if there is a call to a tool that does not exist, the build errors.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210426203518.981550-1-nathan@kernel.org/"><code>[PATCH] powerpc: Avoid clang uninitialized warning in __get_user_size_allowed</code></a>: Clang&rsquo;s static analysis pointed out a false positive, which was fixed in one place but not another, causing a build failure in our CI due to <code>-Werror</code> in <code>arch/powerpc</code>.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210429012350.600951-1-nathan@kernel.org/"><code>[PATCH] Makefile: Move -Wno-unused-but-set-variable out of GCC only block</code></a>: Clang&rsquo;s implementation of this warning is coming down the pipeline so this disables it like GCC in a default build. Ideally, we want to enable rather than disable warnings but this is a special case because it is also disabled for GCC by default.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210429232611.3966964-1-nathan@kernel.org/"><code>[PATCH] x86: Enable clang LTO for 32-bit as well</code></a>: LTO was merged in 5.12 for arm64 and x86_64. In my testing, I noticed that 32-bit x86 works fine and there is <a href="https://github.com/ClangBuiltLinux/linux/issues/1163">some interest</a> in this.</p>
</li>
</ul>
<h2 id="patch-review-and-input">Patch review and input<a hidden class="anchor" aria-hidden="true" href="#patch-review-and-input">#</a></h2>
<p>When possible, I link directly to my response but sometimes, the link is to the main post and my response can be seen inline.</p>
<ul>
<li>
<p><a href="https://lore.kernel.org/r/20210402195823.huphtlhluqjgrw26@archlinux-ax161/"><code>Re: [PATCH v5 00/18] Add support for Clang CFI</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/41#issuecomment-812055354"><code>overlay: Exit rcS script so it only runs once</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210402211552.dzcxxs5scz7ddxtt@Ryzen-9-3900X.localdomain/"><code>Re: [PATCH 3/3] kbuild: fix false-positive modpost warning when all symbols are trimmed</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210407185456.41943-1-ndesaulniers@google.com/"><code>[PATCH 0/2] gcov: re-fix clang-11 support</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210407!213337.5zzpfs5epzdp75sj@archlinux-ax161/"><code>Re: [PATCH v4 12/12] exec: Fix overlap of PAGE_ANON and PAGE_TARGET_1</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210407214747.kaemm45tut3jw5in@archlinux-ax161/"><code>Re: [PATCH v9] pgo: add clang's Profile Guided Optimization infrastructure</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YHYlQnFRMNdn%2FCDp@archlinux-ax161/"><code>Re: [PATCH] arm64: vdso32: drop -no-integrated-as flag</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YHeGJzhIhSFJLprr@archlinux-ax161/"><code>Re: [PATCH v2] arm64: vdso32: drop -no-integrated-as flag</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D100412#2690236"><code>[Aarch64] handle &quot;o&quot; inline asm memory constraints</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YIBcd+5NKJFnkTC1@archlinux-ax161/"><code>Re: [PATCH] KVM: x86: Fix implicit enum conversion goof in scattered reverse CPUID code</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YIIVlahVlJAsaE9W@archlinux-ax161/"><code>Re: [PATCH] x86/boot/compressed: enable -Wundef</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YIIcoz4fHjVjWHTI@archlinux-ax161/"><code>Re: [PATCH] stack: replace &quot;o&quot; output with &quot;r&quot; input constraint</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/125"><code>Hexagon CI coverage</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D101657"><code>[PowerPC] Handle inline assembly clobber of link regsiter</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1363"><code>Assertion </code>MI-&gt;getOperand(0).isReg()&rsquo; failed`</a></p>
</li>
</ul>
<h2 id="issue-triage-and-reporting">Issue triage and reporting<a hidden class="anchor" aria-hidden="true" href="#issue-triage-and-reporting">#</a></h2>
<p>A lot more issues in upstream LLVM this month and I ran into two regressions with external tools. Thankfully, those were quick to be resolved so testing could get back on track. As with previous months, the link is usually to the main post/issue and my input can be seen throughout.</p>
<ul>
<li>
<p><a href="https://bugs.launchpad.net/qemu/+bug/1922617"><code>qemu-aarch64-static &quot;Illegal instruction&quot; with debootstrap</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210402195241.gahc5w25gezluw7p@archlinux-ax161/"><code>CFI violation in drivers/infiniband/core/sysfs.c</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210408182253.6m3j6lhmh3iflquz@archlinux-ax161/"><code>mkimage regression when building ARCH=mips defconfig Linux kernel</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1341"><code>inconsistent ORC unwind table entries in file: vmlinux in /scripts/sorttable vmlinux</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1344"><code>-Wframe-larger-than= in sound/core/control_led.c</code></a></p>
</li>
<li>
<p><a href="https://gitlab.com/Linaro/tuxmake/-/issues/133"><code>perl spam when running tuxmake without a runtime</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/issues/118"><code>clang-nightly arm toolchain outdated?</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1346"><code>undefined symbol: __compiletime_assert_177 in firmware/stratix10-rsu.o</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1345"><code>ppc44x_defconfig has stopped booting on next</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1347"><code>&quot;error: expected assembly-time absolute expression&quot; in arch/arm64/kernel/entry.S</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210413200057.ankb4e26ytgal7ev@archlinux-ax161/"><code>arch/arm64/kvm/perf.c:58:36: error: implicit declaration of function 'perf_num_counters'</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YHhK4twu3feLG3AR@archlinux-ax161/"><code>Re: [PATCH 2/3] habanalabs: support legacy and new pll indexes</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1356"><code>s390: Issue around the ALTERNATIVE macro with integrated-as</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1358"><code>error: couldn't allocate output register for constraint 'x'</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1359"><code>-Wsometimes-uninitialized in arch/powerpc/include/asm/uaccess.h</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YIcLcujmoK6Yet9d@archlinux-ax161/"><code>Re: [PATCH v7] powerpc/irq: Inline call_do_irq() and call_do_softirq()</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D94355#2717531"><code>[Passes] Add relative lookup table converter pass</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D91722#2724321"><code>[DebugInfo] Use variadic debug values to salvage BinOps and GEP instrs with non-const operands</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1361"><code>&quot;Not a NOP&quot; warning when booting i386_defconfig</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D100884#2724725"><code>Generalize getInvertibleOperand recurrence handling slightly</code></a></p>
</li>
<li>
<p><a href=""><code>chkobjdump.awk: no default action when using llvm-objdump</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1364"><code>Formatting of llvm-objdump trips up x86 insn_decoder_test</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/YItU3YrFi8REwkRA@archlinux-ax161/"><code>Re: Very slow clang kernel config ..</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1365"><code>5.12 boot failure when ThinLTO is enabled</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1366"><code>-Wconstant-conversion in drivers/platform/surface/surface_aggregator_registry.c</code></a></p>
</li>
</ul>
<h2 id="tooling-improvements">Tooling improvements<a hidden class="anchor" aria-hidden="true" href="#tooling-improvements">#</a></h2>
<p>A little all over the place this month, no major work now that the continuous integration setup is stable and the other tools are working well.</p>
<ul>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/146"><code>build-llvm.py: Build compiler-rt builtins</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/42"><code>buildroot: Check init.d action to avoid double version print out</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/43"><code>debian/build.sh: qemu-debootstrap -&gt; debootstrap</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/123"><code>Make it green as of 4-26-2021</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/44"><code>boot-qemu.sh: Do not set earlycon for arm32_v6</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/126"><code>Enable LLVM_IAS=1 for arm32 allmodconfig on android-mainline</code></a></p>
</li>
</ul>
<h2 id="behind-the-scenes">Behind the scenes<a hidden class="anchor" aria-hidden="true" href="#behind-the-scenes">#</a></h2>
<p>Three things that were more behind the scenes this month:</p>
<ul>
<li>
<p>ClangBuiltLinux did a bug scrub on two days, where we sat down in Google Meet and worked on a shared Google Doc to try and see if we could reproduce old issues. I think we ended up touching somewhere around 100 issues, closing several issues that are no longer relevant. This will allow us to stay focused and work through a clean backlog as we have time in the future. It is the balance of dealing with new issues while finding time to work on the old or getting more people involved with the project ;)</p>
</li>
<li>
<p>I did a lot of testing of the Control Flow Integrity series on both arm64 (which I mention above) and x86_64. Unfortunately, the x86_64 testing became moot when the x86 maintainers basically <a href="https://lore.kernel.org/r/CALCETrV6WYx7dt56aCuUYsrrFya==zYR+p-YZnaATptnaO7w2A@mail.gmail.com/">NAK&rsquo;d</a> the series in its current form. I will continue testing in May, hoping to tease out any failures so that those are all resolved by the time the series is ready for a new revision.</p>
</li>
<li>
<p>I received a <a href="https://beagleboard.org/beaglev">BeagleV board</a> as part of their beta program for the sake of testing clang built kernels on it. I messed around with it a little bit already, I will continue this in May.</p>
</li>
</ul>
<h2 id="special-thanks-to">Special thanks to:<a hidden class="anchor" aria-hidden="true" href="#special-thanks-to">#</a></h2>
<ul>
<li><a href="https://www.google.com/">Google</a> and <a href="https://linuxfoundation.org/">the Linux Foundation</a> for <a href="https://linuxfoundation.org/en/press-release/google-funds-linux-kernel-developers-to-focus-exclusively-on-security/">sponsoring my work</a>!</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://nathanchance.dev/tags/clangbuiltlinux/">clangbuiltlinux</a></li>
      <li><a href="https://nathanchance.dev/tags/linux/">linux</a></li>
      <li><a href="https://nathanchance.dev/tags/linuxfoundation/">linuxfoundation</a></li>
      <li><a href="https://nathanchance.dev/tags/maintainer/">maintainer</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://nathanchance.dev/posts/may-2021-cbl-work/">
    <span class="title">« Prev</span>
    <br>
    <span>May 2021 ClangBuiltLinux Work</span>
  </a>
  <a class="next" href="https://nathanchance.dev/posts/march-2021-cbl-work/">
    <span class="title">Next »</span>
    <br>
    <span>March 2021 ClangBuiltLinux Work</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on twitter"
        href="https://twitter.com/intent/tweet/?text=April%202021%20ClangBuiltLinux%20Work&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f&amp;hashtags=clangbuiltlinux%2clinux%2clinuxfoundation%2cmaintainer">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f&amp;title=April%202021%20ClangBuiltLinux%20Work&amp;summary=April%202021%20ClangBuiltLinux%20Work&amp;source=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f&title=April%202021%20ClangBuiltLinux%20Work">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on whatsapp"
        href="https://api.whatsapp.com/send?text=April%202021%20ClangBuiltLinux%20Work%20-%20https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share April 2021 ClangBuiltLinux Work on telegram"
        href="https://telegram.me/share/url?text=April%202021%20ClangBuiltLinux%20Work&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fapril-2021-cbl-work%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer><div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://nathanchance.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://nathanchance.dev/">Nathan Chancellor</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
