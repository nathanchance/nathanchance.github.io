<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>March 2021 ClangBuiltLinux Work | Nathan Chancellor</title>
<meta name="keywords" content="clangbuiltlinux, linux, linuxfoundation, maintainer">
<meta name="description" content="Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.
Linux kernel patches


powerpc/fadump: Mark fadump_calculate_reserve_size as __init: LLVM 13 switched over to the New Pass Manager (NPM), which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, identical_pvr_fixup() was not marked as __init and it was not getting inlined so the calls to identify_cpu() and of_get_flat_dt_prop() resulting in the modpost warnings. In practice, this is not an issue because identical_pvr_fixup() is only called from __init context but it is important to get these things right so that real warnings can easily be caught.">
<meta name="author" content="Nathan Chancellor">
<link rel="canonical" href="https://nathanchance.dev/posts/march-2021-cbl-work/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css" integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://nathanchance.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://nathanchance.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://nathanchance.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://nathanchance.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://nathanchance.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://nathanchance.dev/posts/march-2021-cbl-work/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://nathanchance.dev/posts/march-2021-cbl-work/">
  <meta property="og:site_name" content="Nathan Chancellor">
  <meta property="og:title" content="March 2021 ClangBuiltLinux Work">
  <meta property="og:description" content="Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.
Linux kernel patches powerpc/fadump: Mark fadump_calculate_reserve_size as __init: LLVM 13 switched over to the New Pass Manager (NPM), which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, identical_pvr_fixup() was not marked as __init and it was not getting inlined so the calls to identify_cpu() and of_get_flat_dt_prop() resulting in the modpost warnings. In practice, this is not an issue because identical_pvr_fixup() is only called from __init context but it is important to get these things right so that real warnings can easily be caught.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-04-01T10:25:53-07:00">
    <meta property="article:modified_time" content="2021-04-01T10:25:53-07:00">
    <meta property="article:tag" content="Clangbuiltlinux">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Linuxfoundation">
    <meta property="article:tag" content="Maintainer">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="March 2021 ClangBuiltLinux Work">
<meta name="twitter:description" content="Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.
Linux kernel patches


powerpc/fadump: Mark fadump_calculate_reserve_size as __init: LLVM 13 switched over to the New Pass Manager (NPM), which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, identical_pvr_fixup() was not marked as __init and it was not getting inlined so the calls to identify_cpu() and of_get_flat_dt_prop() resulting in the modpost warnings. In practice, this is not an issue because identical_pvr_fixup() is only called from __init context but it is important to get these things right so that real warnings can easily be caught.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://nathanchance.dev/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "March 2021 ClangBuiltLinux Work",
      "item": "https://nathanchance.dev/posts/march-2021-cbl-work/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "March 2021 ClangBuiltLinux Work",
  "name": "March 2021 ClangBuiltLinux Work",
  "description": "Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.\nLinux kernel patches powerpc/fadump: Mark fadump_calculate_reserve_size as __init: LLVM 13 switched over to the New Pass Manager (NPM), which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, identical_pvr_fixup() was not marked as __init and it was not getting inlined so the calls to identify_cpu() and of_get_flat_dt_prop() resulting in the modpost warnings. In practice, this is not an issue because identical_pvr_fixup() is only called from __init context but it is important to get these things right so that real warnings can easily be caught.\n",
  "keywords": [
    "clangbuiltlinux", "linux", "linuxfoundation", "maintainer"
  ],
  "articleBody": "Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.\nLinux kernel patches powerpc/fadump: Mark fadump_calculate_reserve_size as __init: LLVM 13 switched over to the New Pass Manager (NPM), which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, identical_pvr_fixup() was not marked as __init and it was not getting inlined so the calls to identify_cpu() and of_get_flat_dt_prop() resulting in the modpost warnings. In practice, this is not an issue because identical_pvr_fixup() is only called from __init context but it is important to get these things right so that real warnings can easily be caught.\npowerpc/prom: Mark identical_pvr_fixup as __init: Same situation as above :)\nMakefile: Remove '--gcc-toolchain' flag and Makefile: Only specify '--prefix=' when building with clang + GNU as: These two patches clean up our clang specific compiler flags. I noticed that we specify --prefix= with a full path after commit ca9b31f6bb9c (“Makefile: Fix GCC_TOOLCHAIN_DIR prefix for Clang cross compilation”), meaning that --gcc-toolchain= is unnecessary because the kernel uses nothing within the sysroot usually provided by GCC. As a follow up, specifying --prefix= is only necessary when we are using the GNU assembler.\nARM: Make UNWINDER_ARM depend on ld.bfd or ld.lld 11.0.0+: A workaround for a bug in all LLD versions prior to 11.0.0. The kernel’s minimum supported version of LLVM is 10.0.1, meaning that if something is broken with LLVM 10.0.1+, it must be fixed or worked around. KernelCI has run into this as their testing plan is now the minimum supported version of LLVM and the latest stable version.\nriscv: Fix CONFIG_FUNCTION_TRACER with clang: This series fixes build errors on RISC-V when CONFIG_FUNCTION_TRACER is set. This was a rather fun series to develop but at the same time, incredibly frustrating because of how it evolved. Unfortunately, it requires a kind of ugly workaround due to an LLVM bug (more on that below). I am hoping that it will be picked up before Linux 5.12 is released but it is not like it cannot be backported to stable.\nriscv: Use $(LD) instead of $(CC) to link vDSO: In traditional projects, the linker is never directly invoked; instead, the compiler is called and it calls the linker implicitly. For the kernel, it is the other way around: the compiler is only used to build .o files and the linker is directly invoked on them, except in certain vDSO Makefiles. We have been working on getting rid of this and making the behavior consistent over the kernel so that ld.lld can be used in more places, as clang by default defauls to calling ld.bfd.\nFix cross compiling x86 with clang: Back in December, someone reported that x86 was not cross compilable due to a lack of the --target= flag. This is not a very common task as x86 is the dominant architecture but arm64 is starting to become more common, especially with Apple’s M1 chip. This series adds the --target= flag to specific subdirectories that have hand rolled KBUILD_CFLAGS (which is an antipattern that should really be avoided but simple fix for now).\nLLVM patches I contributed a few small patches to LLVM this month:\ndebuginfo-tests: Fix check-gdb-mlir-support build after MLIR API change in a4bb667d831c: A MILR API change that was not reflected back in the MILR debuginfo-tests.\n[RISCV] Fix mcount name: This is the LLVM side of the RISC-V function tracing series above. Somehow, LLVM used a different name for the mcount symbol than GCC did, which needed to be fixed. Thankfully, LLVM already had the plumbing inside of it for this, I just had to hook into it for RISC-V and add some tests.\nlibc: Default LIBC_INSTALL_PREFIX to ${CMAKE_INSTALL_PREFIX}: While working on the full toolchain tc-build series below, I ran into this issue while running ninja install.\nPatch review and input I feel like I gave more input/review this month than I have before, which is never a bad thing :) Being a quick reviewer for others incentivizes them to give you a quick review in return. For some of the links below, I linked the top message/patch; my full input can be seen at the bottom by clicking on my name.\n[PATCH] Fix ld-version.sh script if LLD was built with LLD_VENDOR\n[PATCH 1/4] kbuild: remove LLVM=1 test from HAS_LTO_CLANG\n[PATCH] MIPS: Add comment about CONFIG_MIPS32_O32 in loongson3_defconfig when build with Clang and Re: [PATCH v2] MIPS: Make MIPS32_O32 depends on !CC_IS_CLANG\nRe: [PATCH] KVM: arm64: Don't use cbz/adr with external symbols\nRe: [PATCH] kbuild: dummy-tools: adjust to scripts/cc-version.sh\n[PATCH] gcov: fix clang-11+ support\nRe: [PATCH] kbuild: fix ld-version.sh to not be affected by locale\nThumb2 ias\nGcov\nspin down LTO builds of Sami's LTO tree\nAdd Android ARCH=arm LLVM_IAS=1 5.4+ coverage\nArm android cleanup\ndebian: build.sh: add missing quotes to MODULES_FOLDER\nfix -g\nIssue triage and reporting Healthy dose of LLVM regressions and Linux kernel build failures due to new functionality.\n[mlir] Simplify various pieces of code now that Identifier has access to the Context/Dialect\n[mlir][IR] Refactor the internal implementation of Value\n[AST] Add generator for source location introspection\n[RISCV] Add basic cost modelling for fixed vector gather/scatter.\n(continuous-integration2) incomplete logs?\nBuild failures with LLVM 13.0.0-++20210330111113+6d2fb3cefba6-1~exp1~20210330091825.3874\nclang-12: error: unsupported option '-fpatchable-function-entry=8' for target 'riscv64-unknown-linux-gnu'\nIssue around hyp_panic while building aarch64 allmodconfig with ThinLTO\nFaild to build qcacld-3.0 on msm-5.4 kernel\n-Walign-mismatch in include/linux/efi.h\na0e2bf7cb7006b5a58ee81f4da4fe575875f2781 in -next breaks compiling with CFI\nmcount problem on RISC-V\nld.lld: error in arch/arm64/kernel/vmlinux.lds\nRe: [PATCH 3/4] certs: Add ability to preload revocation certs\n-Walign-mismatch in block/blk-mq.c\nRe: [PATCH 2/2] zonefs: Fix O_APPEND async write handling\nRe: Clang: powerpc: kvm/book3s_hv_nested.c:264:6: error: stack frame size of 2480 bytes in function 'kvmhv_enter_nested_guest'\nRe: [PATCH v8 09/13] phy: tegra: xusb: Add wake/sleepwalk for Tegra210\n8ec7ea3ddce7379e13e8dfb4a5260a6d2004aa1c causes more stack usage on PowerPC\nTooling patches I focused on streamlining our boot utilities, increasing the build coverage, and improving the toolchain build scripts.\nbuildroot: Speed up build times\nboot-qemu.sh: Add support for earlycon\nEnable LTO testing on mainline and -next\nDrop CONFIG_UBSAN_UNSIGNED_OVERFLOW from all*configs\ngithub: Add check-clang.sh workflow\ngenerate_workflow.py: Drop usedForSecurity in hashlib call\nChange MIPS base config\nutils.py: Fix get_cbl_name() for mipsel\nMove Android back to ThinLTO for now\nAdd support for arm64 trees\nTest allmodconfig with LTO and defconfig with full LTO\nEnable i386 builds on older trees\nDisable pseries_defconfig on LLVM 12\nboot-utils: Update\nCompletely spin down LTO builds on Sami's tree\nSupport for Clear Linux\nUpdate to Linux 5.11.3 and bump the known good revision\nSimplify the flags in build-binutils.py\nbuild-binutils.py: Remove '--with-sysroot' configuration flag\nMake script more friendly to being used system-wide/LLVM development and add more kernel PGO options\nConclusion When dealing with various issues all at once, it is hard to see any progress being made so doing these status reports is a great way to help keep myself grounded and realize that progress is indeed being made. There are some cool things in development such as Sami Tolvanen’s Control Flow Integrity series, which is high priority for testing on arm64. Stay tuned for more on that!\n",
  "wordCount" : "1233",
  "inLanguage": "en",
  "datePublished": "2021-04-01T10:25:53-07:00",
  "dateModified": "2021-04-01T10:25:53-07:00",
  "author":{
    "@type": "Person",
    "name": "Nathan Chancellor"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nathanchance.dev/posts/march-2021-cbl-work/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nathan Chancellor",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nathanchance.dev/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://nathanchance.dev/" accesskey="h" title="Nathan Chancellor (Alt + H)">Nathan Chancellor</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://nathanchance.dev/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/nc_resume.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="https://nathanchance.dev/downloads/" title="Downloads">
                    <span>Downloads</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      March 2021 ClangBuiltLinux Work
    </h1>
    <div class="post-meta"><span title='2021-04-01 10:25:53 -0700 MST'>April 1, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Nathan Chancellor&nbsp;|&nbsp;<a href="https://github.com/nathanchance/hugo-files/blob/main/content/posts/march-2021-cbl-work.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#linux-kernel-patches" aria-label="Linux kernel patches">Linux kernel patches</a></li>
                <li>
                    <a href="#llvm-patches" aria-label="LLVM patches">LLVM patches</a></li>
                <li>
                    <a href="#patch-review-and-input" aria-label="Patch review and input">Patch review and input</a></li>
                <li>
                    <a href="#issue-triage-and-reporting" aria-label="Issue triage and reporting">Issue triage and reporting</a></li>
                <li>
                    <a href="#tooling-patches" aria-label="Tooling patches">Tooling patches</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Another month, another post about the work that I have done as a kernel/compiler developer! One of the highlights this month is that I got LLVM commit access so I can merge my own patches into LLVM, which I did twice so far.</p>
<h2 id="linux-kernel-patches">Linux kernel patches<a hidden class="anchor" aria-hidden="true" href="#linux-kernel-patches">#</a></h2>
<ul>
<li>
<p><a href="https://lore.kernel.org/r/20210302195013.2626335-1-nathan@kernel.org/"><code>powerpc/fadump: Mark fadump_calculate_reserve_size as __init</code></a>: LLVM 13 switched over to the <a href="https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/">New Pass Manager (NPM)</a>, which has impacted some inlining decisions, which in turn exposed some bugs in section annotations. The kernel places certain functions and variables into specific sections that are discarded and freed after init. If a non-init function calls an init function, that is technically a use-after-free so the kernel warns when this happens. In this particular case, <code>identical_pvr_fixup()</code> was not marked as <code>__init</code> and it was not getting inlined so the calls to <code>identify_cpu()</code> and <code>of_get_flat_dt_prop()</code> resulting in the modpost warnings. In practice, this is not an issue because <code>identical_pvr_fixup()</code> is only called from <code>__init</code> context but it is important to get these things right so that real warnings can easily be caught.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210302200829.2680663-1-nathan@kernel.org/"><code>powerpc/prom: Mark identical_pvr_fixup as __init</code></a>: Same situation as above :)</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210309205915.2340265-1-nathan@kernel.org/"><code>Makefile: Remove '--gcc-toolchain' flag</code></a> and <a href="https://lore.kernel.org/r/20210309205915.2340265-2-nathan@kernel.org/"><code>Makefile: Only specify '--prefix=' when building with clang + GNU as</code></a>: These two patches clean up our clang specific compiler flags. I noticed that we specify <code>--prefix=</code> with a full path after commit <a href="https://git.kernel.org/linus/ca9b31f6bb9c6aa9b4e5f0792f39a97bbffb8c51">ca9b31f6bb9c</a> (&ldquo;Makefile: Fix GCC_TOOLCHAIN_DIR prefix for Clang cross compilation&rdquo;), meaning that <code>--gcc-toolchain=</code> is unnecessary because the kernel uses nothing within the sysroot usually provided by GCC. As a follow up, specifying <code>--prefix=</code> is only necessary when we are using the GNU assembler.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210311005418.2207250-1-nathan@kernel.org/"><code>ARM: Make UNWINDER_ARM depend on ld.bfd or ld.lld 11.0.0+</code></a>: A workaround for a bug in all LLD versions prior to 11.0.0. The kernel&rsquo;s minimum supported version of LLVM is 10.0.1, meaning that if something is broken with LLVM 10.0.1+, it must be fixed or worked around. KernelCI has run into this as their testing plan is now the minimum supported version of LLVM and the latest stable version.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210325223807.2423265-1-nathan@kernel.org/"><code>riscv: Fix CONFIG_FUNCTION_TRACER with clang</code></a>: This series fixes build errors on RISC-V when <code>CONFIG_FUNCTION_TRACER</code> is set. This was a rather fun series to develop but at the same time, incredibly frustrating because of how it evolved. Unfortunately, it requires a kind of ugly workaround due to an LLVM bug (more on that below). I am hoping that it will be picked up before Linux 5.12 is released but it is not like it cannot be backported to stable.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210325215156.1986901-1-nathan@kernel.org/"><code>riscv: Use $(LD) instead of $(CC) to link vDSO</code></a>: In traditional projects, the linker is never directly invoked; instead, the compiler is called and it calls the linker implicitly. For the kernel, it is the other way around: the compiler is only used to build <code>.o</code> files and the linker is directly invoked on them, except in certain vDSO Makefiles. We have been working on getting rid of this and making the behavior consistent over the kernel so that <code>ld.lld</code> can be used in more places, as <code>clang</code> by default defauls to calling <code>ld.bfd</code>.</p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210326000435.4785-1-nathan@kernel.org/"><code>Fix cross compiling x86 with clang</code></a>: Back in December, someone reported that x86 was not cross compilable due to a lack of the <code>--target=</code> flag. This is not a very common task as x86 is the dominant architecture but arm64 is starting to become more common, especially with Apple&rsquo;s M1 chip. This series adds the <code>--target=</code> flag to specific subdirectories that have hand rolled <code>KBUILD_CFLAGS</code> (which is an antipattern that should really be avoided but simple fix for now).</p>
</li>
</ul>
<h2 id="llvm-patches">LLVM patches<a hidden class="anchor" aria-hidden="true" href="#llvm-patches">#</a></h2>
<p>I contributed a few small patches to LLVM this month:</p>
<ul>
<li>
<p><a href="https://reviews.llvm.org/D98613"><code>debuginfo-tests: Fix check-gdb-mlir-support build after MLIR API change in a4bb667d831c</code></a>: A MILR API change that was not reflected back in the MILR debuginfo-tests.</p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D98881"><code>[RISCV] Fix mcount name</code></a>: This is the LLVM side of the RISC-V function tracing series above. Somehow, LLVM used a different name for the mcount symbol than GCC did, which needed to be fixed. Thankfully, LLVM already had the plumbing inside of it for this, I just had to hook into it for RISC-V and add some tests.</p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D99636"><code>libc: Default LIBC_INSTALL_PREFIX to ${CMAKE_INSTALL_PREFIX}</code></a>: While working on the full toolchain tc-build series below, I ran into this issue while running <code>ninja install</code>.</p>
</li>
</ul>
<h2 id="patch-review-and-input">Patch review and input<a hidden class="anchor" aria-hidden="true" href="#patch-review-and-input">#</a></h2>
<p>I feel like I gave more input/review this month than I have before, which is never a bad thing :) Being a quick reviewer for others incentivizes them to give you a quick review in return. For some of the links below, I linked the top message/patch; my full input can be seen at the bottom by clicking on my name.</p>
<ul>
<li>
<p><a href="https://lore.kernel.org/r/20210302221211.1620858-1-bero@lindev.ch/"><code>[PATCH] Fix ld-version.sh script if LLD was built with LLD_VENDOR</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210303183333.46543-1-masahiroy@kernel.org/"><code>[PATCH 1/4] kbuild: remove LLVM=1 test from HAS_LTO_CLANG</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/1614820544-10686-1-git-send-email-yangtiezhu@loongson.cn/"><code>[PATCH] MIPS: Add comment about CONFIG_MIPS32_O32 in loongson3_defconfig when build with Clang</code></a> and <a href="https://lore.kernel.org/r/20210304064552.xzjqbhltghmd5vfa@archlinux-ax161/"><code>Re: [PATCH v2] MIPS: Make MIPS32_O32 depends on !CC_IS_CLANG</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210307043545.pyxy22z3rktgof4m@archlinux-ax161/"><code>Re: [PATCH] KVM: arm64: Don't use cbz/adr with external symbols</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210309173745.lbinnmjrmamld2rs@archlinux-ax161/"><code>Re: [PATCH] kbuild: dummy-tools: adjust to scripts/cc-version.sh</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210312192139.2503087-1-ndesaulniers@google.com/"><code>[PATCH] gcov: fix clang-11+ support</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210312194956.vsikqyaya676qvcu@archlinux-ax161/"><code>Re: [PATCH] kbuild: fix ld-version.sh to not be affected by locale</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/101"><code>Thumb2 ias</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/107"><code>Gcov</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/114"><code>spin down LTO builds of Sami's LTO tree</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/115"><code>Add Android ARCH=arm LLVM_IAS=1 5.4+ coverage</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/116"><code>Arm android cleanup</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/37"><code>debian: build.sh: add missing quotes to MODULES_FOLDER</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/39"><code>fix -g</code></a></p>
</li>
</ul>
<h2 id="issue-triage-and-reporting">Issue triage and reporting<a hidden class="anchor" aria-hidden="true" href="#issue-triage-and-reporting">#</a></h2>
<p>Healthy dose of LLVM regressions and Linux kernel build failures due to new functionality.</p>
<ul>
<li>
<p><a href="https://reviews.llvm.org/D97431#2598012"><code>[mlir] Simplify various pieces of code now that Identifier has access to the Context/Dialect</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D97804#2625161"><code>[mlir][IR] Refactor the internal implementation of Value</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D93164#2630203"><code>[AST] Add generator for source location introspection</code></a></p>
</li>
<li>
<p><a href="https://reviews.llvm.org/D99142#2651729"><code>[RISCV] Add basic cost modelling for fixed vector gather/scatter.</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/issues/105"><code>(continuous-integration2) incomplete logs?</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/issues/117"><code>Build failures with LLVM 13.0.0-++20210330111113+6d2fb3cefba6-1~exp1~20210330091825.3874</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1268"><code>clang-12: error: unsupported option '-fpatchable-function-entry=8' for target 'riscv64-unknown-linux-gnu'</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1317"><code>Issue around hyp_panic while building aarch64 allmodconfig with ThinLTO</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1323"><code>Faild to build qcacld-3.0 on msm-5.4 kernel</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1327"><code>-Walign-mismatch in include/linux/efi.h</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1330"><code>a0e2bf7cb7006b5a58ee81f4da4fe575875f2781 in -next breaks compiling with CFI</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1331"><code>mcount problem on RISC-V</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/linux/issues/1336"><code>ld.lld: error in arch/arm64/kernel/vmlinux.lds</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210303181121.ii7ofii65lh337ln@archlinux-ax161/"><code>Re: [PATCH 3/4] certs: Add ability to preload revocation certs</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210310182307.zzcbi5w5jrmveld4@archlinux-ax161/"><code>-Walign-mismatch in block/blk-mq.c</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210315170855.tguqrsl7wsbjojib@archlinux-ax161/"><code>Re: [PATCH 2/2] zonefs: Fix O_APPEND async write handling</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210319170154.oe5sa6ohjbyucbws@archlinux-ax161/"><code>Re: Clang: powerpc: kvm/book3s_hv_nested.c:264:6: error: stack frame size of 2480 bytes in function 'kvmhv_enter_nested_guest'</code></a></p>
</li>
<li>
<p><a href="https://lore.kernel.org/r/20210325202616.xgjkdg7zev6apofe@archlinux-ax161/"><code>Re: [PATCH v8 09/13] phy: tegra: xusb: Add wake/sleepwalk for Tegra210</code></a></p>
</li>
<li>
<p><a href="https://llvm.org/pr49610"><code>8ec7ea3ddce7379e13e8dfb4a5260a6d2004aa1c causes more stack usage on PowerPC</code></a></p>
</li>
</ul>
<h2 id="tooling-patches">Tooling patches<a hidden class="anchor" aria-hidden="true" href="#tooling-patches">#</a></h2>
<p>I focused on streamlining our boot utilities, increasing the build coverage, and improving the toolchain build scripts.</p>
<ul>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/38"><code>buildroot: Speed up build times</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/boot-utils/pull/40"><code>boot-qemu.sh: Add support for earlycon</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/94"><code>Enable LTO testing on mainline and -next</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/97"><code>Drop CONFIG_UBSAN_UNSIGNED_OVERFLOW from all*configs</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/99"><code>github: Add check-clang.sh workflow</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/100"><code>generate_workflow.py: Drop usedForSecurity in hashlib call</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/102"><code>Change MIPS base config</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/103"><code>utils.py: Fix get_cbl_name() for mipsel</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/106"><code>Move Android back to ThinLTO for now</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/108"><code>Add support for arm64 trees</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/109"><code>Test allmodconfig with LTO and defconfig with full LTO</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/110"><code>Enable i386 builds on older trees</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/111"><code>Disable pseries_defconfig on LLVM 12</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/112"><code>boot-utils: Update</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/continuous-integration2/pull/114"><code>Completely spin down LTO builds on Sami's tree</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/141"><code>Support for Clear Linux</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/142"><code>Update to Linux 5.11.3 and bump the known good revision</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/143"><code>Simplify the flags in build-binutils.py</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/144"><code>build-binutils.py: Remove '--with-sysroot' configuration flag</code></a></p>
</li>
<li>
<p><a href="https://github.com/ClangBuiltLinux/tc-build/pull/145"><code>Make script more friendly to being used system-wide/LLVM development and add more kernel PGO options</code></a></p>
</li>
</ul>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>When dealing with various issues all at once, it is hard to see any progress being made so doing these status reports is a great way to help keep myself grounded and realize that progress is indeed being made. There are some cool things in development such as Sami Tolvanen&rsquo;s <a href="https://lore.kernel.org/r/20210331212722.2746212-1-samitolvanen@google.com/">Control Flow Integrity series</a>, which is high priority for testing on arm64. Stay tuned for more on that!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://nathanchance.dev/tags/clangbuiltlinux/">Clangbuiltlinux</a></li>
      <li><a href="https://nathanchance.dev/tags/linux/">Linux</a></li>
      <li><a href="https://nathanchance.dev/tags/linuxfoundation/">Linuxfoundation</a></li>
      <li><a href="https://nathanchance.dev/tags/maintainer/">Maintainer</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://nathanchance.dev/posts/april-2021-cbl-work/">
    <span class="title">« Prev</span>
    <br>
    <span>April 2021 ClangBuiltLinux Work</span>
  </a>
  <a class="next" href="https://nathanchance.dev/posts/february-2021-cbl-work/">
    <span class="title">Next »</span>
    <br>
    <span>February 2021 ClangBuiltLinux Work</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on x"
            href="https://x.com/intent/tweet/?text=March%202021%20ClangBuiltLinux%20Work&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f&amp;hashtags=clangbuiltlinux%2clinux%2clinuxfoundation%2cmaintainer">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f&amp;title=March%202021%20ClangBuiltLinux%20Work&amp;summary=March%202021%20ClangBuiltLinux%20Work&amp;source=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f&title=March%202021%20ClangBuiltLinux%20Work">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on whatsapp"
            href="https://api.whatsapp.com/send?text=March%202021%20ClangBuiltLinux%20Work%20-%20https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on telegram"
            href="https://telegram.me/share/url?text=March%202021%20ClangBuiltLinux%20Work&amp;url=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share March 2021 ClangBuiltLinux Work on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=March%202021%20ClangBuiltLinux%20Work&u=https%3a%2f%2fnathanchance.dev%2fposts%2fmarch-2021-cbl-work%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://nathanchance.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://nathanchance.dev/">Nathan Chancellor</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
